<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>탐라는제주 - 숨어 있던 진짜 hot한 제주</title>
    <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico">
    <meta property="og:title" content="탐라는제주">
    <meta property="og:type" content="website">
    <meta property="og:description" content="탐라는제주 - 숨어 있던 진짜 hot한 제주">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">
    <!-- css -->
    <link rel="stylesheet" href="../../css/common.css" />
    <link rel="stylesheet" href="../../css/layout.css" />
    <!-- sub08 -->
    <link rel="stylesheet" type="text/css" href="../../css/sub08.css">
    <style type="text/css">
        @import url('https://cdn.rawgit.com/innks/NanumSquareRound/master/nanumsquareround.min.css');
    </style>




</head>

<body>
    <div id="header"></div>
    <div id="sub08" class="sub08 container">
        <div id="visual">
            <img src="../../img/sub08/travelLogBackgroundImg.jpg" alt="대표이미지" style='display: none'>
            <div class='visual_inner_box'>
                <div id='title_div'></div>


                <div id='hashTag_div'></div>
                <div id='date_div'></div>
                <div id='partner_div'></div>
                <div id='delete_div'></div>
                <!-- <h5 id='top_date'>여행일: 2018년 4월 20일 - 2018년 4월 30일</h5> -->
                <span class="visual_bg"></span>
            </div>
        </div>
        <!-- visual end -->
        <!-- '1': '혼자',
        '2': '부모님',
        '3': '아이',
        '4': '커플',
        '5': '친구',
        '6': '단체' -->
        <div id="content">


            <!-- 좋아요 탭 -->
            <div class="content_wrap">


                <!-- 지도 -->

                <!-- <div class=map_bb style="width: 100%;height: 400px;background-color: teal;margin-bottom:84px;" style="overflow: hidden;z-index:2; "></div> -->
                <div id="map" style="width:100%;height:400px;margin-bottom:84px; margin-top: 42px;"></div>
            </div>

            <!-- 타임라인 -->

            <div class="t_timeline">

                <nav class="action">
                    <div id="nav_day_bar"></div>


                    <div class="nav_menu">

                        <div id="tree_menu" class="treemenu"></div>

                    </div>


                    <div class="context_writer">
                        <!-- <div class="profile large">
                            <div class="cover">
                                <img src="https://source.unsplash.com/random/700x300" />
                                <div class="layer">
                                    <div class="loader"></div>
                                </div>
                            </div>
                            <div class="user-info">
                                <div class="profile-pic">
                                    <img src="../../img/sub08/img4.jpg" />
                                    <a class="image-wrapper" href="#">
                                        <form id="profilePictureForm" action="#">
                                            <input class="hidden-input" id="changePicture" type="file" />
                                            <label class="edit glyphicon glyphicon-pencil" for="changePicture" type="file" title="Change picture"></label>
                                        </form>
                                    </a>
                                </div>
                                <div class="username">
                                    <div class="name">
                                        <span class="verified"></span>
                                        <a href="#">@zx3620</a>
                                    </div>
                                    <div class="about">모든 제주도를 클리어해보자!!</div>
                                </div>
                                <div class="social-btns">
                                    <a class="btn facebook" href="#">
                                        <i class="fa fa-facebook"></i>
                                    </a>
                                    <a class="btn twitter" href="#">
                                        <i class="fa fa-twitter"></i>
                                    </a>
                                    <a class="btn google" href="#">
                                        <i class="fa fa-google"></i>
                                    </a>
                                </div>
                                <div class="prifile_bottom_msg">
                                    <p>퍼가기</p>
                                </div>
                            </div>
                        </div> -->
                        <div class="auther_post">
                            <div class="post_section">
                                <div class="post_topbox clear">
                                    <div class="post_text">
                                        <b id='recommendation'></b>
                                        <b id='recommendation_name'></b>의 추천 여행기</div>
                                    <a href="#">모두보기</a>
                                </div>
                                <div class="post_content">
                                    <div class="post_content_imgbox">
                                        <a href="#">
                                            <img src="https://source.unsplash.com/random/700x500" />
                                        </a>
                                    </div>
                                    <div class="post_dscrt">
                                        <a href="#">
                                            <div class="post_dscrt_text">한여름의 제주도</div>
                                        </a>
                                        <a>좋아요 : 142,094</a>
                                    </div>
                                </div>
                                <div class="post_content">
                                    <div class="post_content_imgbox">
                                        <a href="#">
                                            <img src="https://source.unsplash.com/random/700x600" />
                                        </a>
                                    </div>
                                    <div class="post_dscrt">
                                        <a href="#">
                                            <div class="post_dscrt_text">애월탐방기</div>
                                        </a>
                                        <a>좋아요 : 215,112</a>
                                    </div>
                                </div>
                                <div class="post_content">
                                    <div class="post_content_imgbox">
                                        <a href="#">
                                            <img src="https://source.unsplash.com/random/700x700" />
                                        </a>
                                    </div>
                                    <div class="post_dscrt">
                                        <a href="#">
                                            <div class="post_dscrt_text">이국적인 서귀포시</div>
                                        </a>
                                        <a>좋아요 : 18,112</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>

                <div id="travel_cont"></div>

                <!-- 라이브리 시티 설치 코드 -->
                <div id='livecity'></div>
            </div>
        </div>
    </div>
    </div>

    <div id="footer"></div>


    <script src="../../js/common/common.js"></script>
    <!-- handlebars -->
    <script src="../../node_modules/handlebars/dist/handlebars.min.js"></script>
    <!-- logo font -->
    <link href="https://fonts.googleapis.com/css?family=Gugi" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- jQuery -->
    <script type="text/javascript" src="../../node_modules/jquery/dist/jquery.min.js"></script>
    <!-- daum map -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=619a7dc4f7d23963aa128663f464c8d5&libraries=services"></script>
    <!-- 카카오로그인 -->
    <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script src="../../js/common/common.js"></script>
    <!-- 시티라이브리 -->
    <script type="text/javascript">
    </script>
    <!-- 시티 설치 코드 끝 -->

    <script type="text/javascript">
        $(document).ready(function () {
            $("#header").load("../include/sub_header.html")
            $("#footer").load("../include/sub_footer.html")
            /* id 지정을 통해서도 가능합니다. 
             $("#header").load("header.html #navbar")
             */
        });
    </script>


    <script>
        // url경로
        var link = document.location.href.split("?")[1];


        $.ajax({

            type: "GET",

            url: serverRoot + "/json/travelLogContent/" + link,

            dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

            success: function (data) {


                var positions = []
                var markers2 = []
                var mapContainer2 = document.getElementById('map'), // 지도를 표시할 div  

                    mapOption = {
                        center: new daum.maps.LatLng(33.37648174461977, 126.55064054368353), // 지도의 중심좌표
                        level: 10 // 지도의 확대 레벨
                    };

                var map2 = new daum.maps.Map(mapContainer2, mapOption); // 지도를 생성합니다

                var marker2 = null;
                var line = null;
                var paths = []
                imageSrc = "http://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";


                for (var i = 0; i < data.length; i++) {

                    // 마커 이미지의 이미지 크기 입니다
                    imageSize = new daum.maps.Size(24, 35);

                    // 마커 이미지를 생성합니다    
                    markerImage = new daum.maps.MarkerImage(imageSrc, imageSize);
                    console.log(markerImage)

                    // 마커를 생성합니다
                    marker2 = new daum.maps.Marker({
                        position: new daum.maps.LatLng(data[i].lotd, data[i].latd), // 마커를 표시할 위치
                        image: markerImage // 마커 이미지 
                    });

                    paths.push(new daum.maps.LatLng(data[i].lotd, data[i].latd))


                    marker2.setMap(map2)
                    markers2.push(marker2)
                }
                var polyline = new daum.maps.Polyline({
                    path: paths, // 선을 구성하는 좌표배열 입니다
                    strokeWeight: 4, // 선의 두께 입니다
                    strokeColor: 'rgb(195, 60, 60);', // 선의 색깔입니다
                    strokeOpacity: 0.7, // 선의 불투명도 입니다 1에서 0 사이의 값이며 0에 가까울수록 투명합니다
                    strokeStyle: 'solid' // 선의 스타일입니다
                });
                polyline.setMap(map2);
                map2.setZoomable();
                // 지도에 표시할 선을 생성합니다

                // 지도에 선을 표시합니다 

            }
        })





        function relayout() {

            // 지도를 표시하는 div 크기를 변경한 이후 지도가 정상적으로 표출되지 않을 수도 있습니다
            // 크기를 변경한 이후에는 반드시  map.relayout 함수를 호출해야 합니다 
            // window의 resize 이벤트에 의한 크기변경은 map.relayout 함수가 자동으로 호출됩니다
            map.relayout();
        }
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            var memberId;
            var contentMember;

            $.get(serverRoot + "/json/auth/islogin", {}, user => {
                memberId = decodeURIComponent(user.id);
            })

            $.ajax({

                type: "GET",

                url: serverRoot + "/json/content/update" + link,

                dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                success: function (data) { 
                   

                }
            })

            $.ajax({

                type: "GET",

                url: serverRoot + "/json/content/" + link,

                dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                success: function (data) { //콘텐트
                    $('#title_div').append(
                        "<h5 id='top_title'>" + data.title + "</h5>")
                    $('#recommendation').html(data.id)
                    contentMember = data.id;
                    $('#delete_div').append(
                        "<button id='list' type='button' class='btn btn-primary'>목록으로</button>"
                    )

                    if (memberId == data.id) {
                        $('#delete_div').append(
                            "<button type='button' class='btn btn-primary'>삭제</button>" +
                            "<button id='update' type='button' class='btn btn-primary'>수정</button>"
                        )
                    }

                    $('#list').click(function () {
                        location.href = 'travelog_list.html'
                    })

                    memberCall()

                }
            })

            function memberCall() {


                $.ajax({

                    type: "GET",

                    url: serverRoot + "/json/member/" + contentMember,

                    dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                    success: function (data) {

                        $('#recommendation_name').html(data.name)


                    }
                })
            }
            $.ajax({

                type: "GET",

                url: serverRoot + "/json/hashTag/" + link,

                dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                success: function (data) {
                    for (let i = 0; i < data.length; i++) {

                        $('#hashTag_div').append(
                            "<h5 id='top_hashTag'>" + data[i].content + "</h5>"
                        )
                    }

                }
            })
            $.ajax({

                type: "GET",

                url: serverRoot + "/json/travelLog/" + link,

                dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                success: function (data) {
                    var partner;

                    $('#date_div').append(
                        "<h5 id='top_date'>" + data.startDate + '~' + data.endDate + "</h5>")

                    if (data.partner == 1) {
                        partner = "#혼자여행";
                    } else if (data.partner == 2) {
                        partner = "#부모님과여행"
                    } else if (data.partner == 3) {
                        partner = "#아이와여행"
                    } else if (data.partner == 4) {
                        partner = "#커플여행"
                    } else if (data.partner == 5) {
                        partner = "#친구와여행"
                    } else if (data.partner == 6) {
                        partner = "#단체여행"
                    }
                    $('#partner_div').append(
                        "<h5 id='top_partner'>" + partner + "</h5>")
                }
            })

            $.ajax({

                type: "GET",

                url: serverRoot + "/json/travelLogContent/" + link,

                dataType: "JSON", // 옵션이므로 JSON으로 받을게 아니면 안써도 됨

                success: function (data) {
                    let scheduleOfDay = [];
                    let maxDay = 0;
                    let no = 0;
                    var md = 0;
                    for (let i in data) {
                        if (maxDay < data[i].day)
                            maxDay = data[i].day;
                    }

                    for (let idx = 0; idx < maxDay; idx++) {
                        scheduleOfDay[idx] = [];

                        for (let schedule of data) {
                            if ((idx + 1) == schedule.day)
                                scheduleOfDay[idx].push(schedule);
                        }

                    }

                    for (var i = 1; i < maxDay + 1; i++) {
                        $("#nav_day_bar").append(
                            "<div class='timeline_content_day fix_day" + i +
                            " day off clear'>" +
                            "<h4> Day" + i + "</h4>" +
                            "<p></p>" +
                            "<p onclick='MoveMap()' class='loadmap'>" + "경로보기" + "</p>" +
                            "</div>")
                    }


                    for (let i = 1; i < scheduleOfDay.length + 1; i++) {
                        $("#tree_menu").append(
                            "<div id='day" + i + "'" + "level='" + no + "' onclick=" +
                            "'fnMove(" + i + ")'" + "class='lbl_titl'>" +
                            "<span class='lbl '>" + i + "일차 </span>" +
                            "</div>"
                        )
                        for (let x = 0; x < scheduleOfDay[i - 1].length; x++) {
                            $("#tree_menu").append(
                                "<div level='1'" + "class='under'>" +
                                "<span class='lbl'>" + scheduleOfDay[i - 1][x].place +
                                "</span>" +
                                "</div>"
                            )
                        }
                    }


                    // 콘텐트
                    for (let i = 1; i < scheduleOfDay.length + 1; i++) {
                        $("#travel_cont").append(
                            "<div id='div" + i + "' class='day" + i + "'>" +
                            "</div>"
                        )
                        $("#div" + i).append(
                            "<div id='cont_day" + i + "' class='timeline_content_day c_day" +
                            i +
                            "'>" +
                            "<h4>" + "Day" + i + "</h4>" +
                            "<p></p>" +
                            "<p onclick='MoveMap()' class='loadmap'>" + "경로보기</p>" +
                            "</div>"
                        )
                        for (let x = 0; x < scheduleOfDay[i - 1].length; x++) {
                            $("#div" + i).append(
                                "<div class='t_timeline_content'>" +
                                "<div class='context_menu'>" +
                                // "<span>" +
                                // "<a href='" + "#" + "'>" + "#데이트" + "</a>" +
                                // "<a href='" + "#" + "'>" + "#포토존" + "</a>" +
                                // "<a href='" + "#" + "'>" + "#꽃" + "</a>" +
                                // "</span>" +
                                "</div>" +

                                "<div class='content_box clear'>" +
                                "<div class='thum_img_box'>" +
                                "<img src=" + serverRoot + "/files/" + scheduleOfDay[i - 1]
                                [x].photo + "_50x50.jpg" + " alt='썸네일사진' />" +
                                "</div>" +
                                "<div class='content_icon'>" +
                                "<p class='contnet_name'>" + scheduleOfDay[i - 1][x].place +
                                "</p>" +
                                "<p class='content_addr'>" + scheduleOfDay[i - 1][x].address +
                                "</p>" +
                                "</div>" +
                                "<div class='content_text'>" +
                                "<p>" + scheduleOfDay[i - 1][x].review + "</p>" +
                                "</div>" +
                                "</div>" +
                                "<div class='t_timeline_content_imgbox'>" +
                                "<figure class='snip0016'>" +
                                "<img src=" + serverRoot + "/files/" + scheduleOfDay[i - 1]
                                [x].photo +
                                " alt='jeju1' />" +
                                "<figcaption>" +
                                "<p>사진더보기</p>" +
                                "<a href='#'></a>" +
                                "</figcaption>" +
                                "</figure>" +
                                "</div>" +
                                "</div>"
                            )
                        }
                    }

                    var _createClass = function () {
                        function defineProperties(target, props) {
                            for (var i = 0; i < props.length; i++) {
                                var descriptor = props[i];
                                descriptor.enumerable = descriptor.enumerable || false;
                                descriptor.configurable = true;
                                if ("value" in descriptor) descriptor.writable = true;
                                Object.defineProperty(target, descriptor.key, descriptor);
                            }
                        }
                        return function (Constructor, protoProps, staticProps) {
                            if (protoProps) defineProperties(Constructor.prototype,
                                protoProps);
                            if (staticProps) defineProperties(Constructor, staticProps);
                            return Constructor;
                        };
                    }();

                    function _classCallCheck(instance, Constructor) {
                        if (!(instance instanceof Constructor)) {
                            throw new TypeError("Cannot call a class as a function");
                        }
                    }

                    window.log = function (text) {
                        // console.log(text);
                        //$(".console").prepend(text + "<br/>");  

                    };

                    var TreeMenu = function () {
                        function TreeMenu($container) {
                            _classCallCheck(this, TreeMenu);


                            this.$container = $container;
                            // $container.find("[level]").scrollTop(this.levelClickHandler.bind(
                            //     this));
                            $container.find("[level]").scrollTop(this.levelClickHandler.bind(
                                this));
                            var id = 0;
                            $container.find("[level]").each(function (index, item) {
                                var $item = $(item);
                                $item.attr("data-treemenu-id", ++id);
                                this.setOpen($item, false);
                                if (parseInt($item.attr("level")) > 0) {
                                    this.hideItem($item);
                                } else {
                                    this.showItem($item);
                                }
                            }.bind(this));
                        }

                        _createClass(TreeMenu, [{
                            key: "levelClickHandler",
                            value: function levelClickHandler(evt) {

                                var $el = $(evt.currentTarget);

                                if (this.isOpen($el)) {
                                    this.closeItem($el);
                                } else {
                                    this.openItem($el);
                                }
                            }
                        }, {
                            key: "getElementTreeMenuId",
                            value: function getElementTreeMenuId($el) {
                                return $el.attr("data-treemenu-id");
                            }
                        }, {
                            key: "getElementLevel",
                            value: function getElementLevel($el) {
                                return parseInt($el.attr("level"));
                            }
                        }, {
                            key: "isOpen",
                            value: function isOpen($el) {
                                return $el.attr("data-treemenu-open") ===
                                    "1";
                            }
                        }, {
                            key: "setOpen",
                            value: function setOpen($el, to) {
                                log("set open: " + to);
                                $el.attr("data-treemenu-open", to ? "1" :
                                    "0");
                            }
                        }, {
                            key: "getGroup",
                            value: function getGroup($el) {
                                log("get group");
                                //the group is every element that has a higher level than this one
                                var firstElementLevel = this.getElementLevel(
                                    $el);
                                var group = [];

                                this.$container.find("[level]").each(
                                    function (
                                        index, item) {
                                        var $item = $(item);

                                        if (!group.length) {
                                            //first item has not been passed in the loop
                                            if (this.getElementTreeMenuId(
                                                    $el) == this.getElementTreeMenuId(
                                                    $item)) {
                                                //the current item is the parent of the group
                                                group.push($item);
                                            }
                                            //stop this iteration of the loop
                                            return true;
                                        }
                                        //
                                        //if the level of the item equals or is lower then the initial level, 
                                        // we have reached the end of the group
                                        var level = parseInt($item.attr(
                                            "level"));
                                        if (level <= firstElementLevel)
                                            return false;
                                        if (level == firstElementLevel +
                                            1)
                                            group.push($item);
                                    }.bind(this));
                                return group;
                            }
                        }, {
                            key: "closeItem",
                            value: function closeItem($el) {
                                this.setOpen($el, false);
                                this.getGroup($el).forEach(function ($item,
                                    index) {
                                    if (!index) return true;
                                    this.hideItem($item);

                                    //also close its children
                                    this.closeItem($item);
                                }.bind(this));
                            }
                        }, {
                            key: "openItem",
                            value: function openItem($el) {
                                this.setOpen($el);
                                $('.under').removeClass('opened');
                                $('.under').addClass('closed');
                                $('.lbl_titl').removeClass('color_active');
                                $('.lbl_titl').removeClass('color_off');
                                ($el).addClass('color_off');
                                ($el).addClass('color_active');
                                this.getGroup($el).forEach(function ($item,
                                    index) {
                                    if (!index) return true;
                                    this.showItem($item);
                                }.bind(this));
                            }
                        }, {
                            key: "showItem",
                            value: function showItem($el) {
                                $el.removeClass("closed");
                                $el.addClass("opened");
                            }
                        }, {
                            key: "hideItem",
                            value: function hideItem($el) {
                                $el.removeClass('opened');
                                $el.addClass("closed");
                            }
                        }]);

                        return TreeMenu;
                    }();

                    var menu = new TreeMenu($(".treemenu"));

                    // fixed

                    $(document).ready(function () {
                        $(window).bind('scroll', function () {
                            var container = $('.container').height();
                            var content = $('.t_timeline').height();
                            if ($(window).scrollTop() > container - content -
                                75) {
                                if ($(window).scrollTop() > content + 80) {
                                    $('nav').addClass('absolute');
                                    $('nav').removeClass('fixed');
                                    return;
                                }
                                $('nav').removeClass('action');
                                $('nav').removeClass('absolute');
                                $('nav').addClass('fixed');
                            } else {
                                $('nav').removeClass('absolute');
                                $('nav').removeClass('fixed');
                                $('nav').addClass('action');
                            }
                        });
                    });

                    //왼쪽 fixed
                    $(document).ready(function () {
                        var sarr = new Array();
                        var cntarr = new Array();
                        var dayPath = new Array();
                        var treeItem = new Array();
                        for (let i = 0; i < maxDay; i++) {
                            sarr.push($('.day' + (i + 1)).offset().top)
                            dayPath.push($('.day' + (i + 1)));
                            treeItem.push($('#day' + (i + 1)))
                        }


                        function action() {
                            for (let y = maxDay; y >= 0; y--) {
                                while ($(document).scrollTop() > sarr[y] - 95) {
                                    $('.day').removeClass('off');
                                    $('.day').addClass('off');
                                    $('.fix_day' + (y + 1)).removeClass('off');
                                    $('.c_day' + (y + 1)).addClass('off');
                                    $('.c_day' + (y + 2)).removeClass('off');
                                    $('.fix_day' + (y + 1)).addClass('on');
                                    menu.openItem(treeItem[y])
                                    return;
                                }
                            }
                        }

                        $(window).bind('scroll', function () {
                            action()
                        });

                    });
                },
                complete: function (data) {

                    // 통신이 실패했어도 완료가 되었을 때 이 함수를 타게 된다.

                    // TODO
                },

                error: function (xhr, status, error) {

                    alert("에러발생");
                }
            });
        });
    </script>

    <script>
        // 아이디 바로가기
        function fnMove(id) {
            var offset = $("#div" + id).offset();
            $('html, body').animate({
                scrollTop: offset.top - 75
            }, 400);
        }
        // 지도로 바로가기
        function MoveMap() {
            var offset = $("#map").offset();
            $('html, body').animate({
                scrollTop: offset.top - 75
            }, 400);
        }
    </script>

    <!-- <script type="text/javascript" src="sub08_view.js"></script> -->
</body>


</html>